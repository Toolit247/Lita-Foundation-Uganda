<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LITA Member Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial,sans-serif; margin:20px; background:#f8fafc; }
    .card { background:#fff; padding:20px; border-radius:16px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
    h2 { color:#1e293b; }
    input, textarea { width:100%; padding:8px; margin:6px 0; border-radius:6px; border:1px solid #ddd; }
    .btn { background:#1d4ed8; color:#fff; border:none; padding:8px 14px; border-radius:8px; cursor:pointer; }
    .btn:hover { background:#1e40af; }
    .progress-entry { background:#f1f5f9; padding:6px; border-radius:6px; margin:4px 0; display:flex; justify-content:space-between; }
  </style>
</head>
<body>
<div class="card">
  <h2>Welcome <span id="memberName"></span></h2>
  <button class="btn" onclick="logout()">Log Out</button>
</div>

<div class="card">
  <h3>Add Business Progress</h3>
  <textarea id="progressText" placeholder="Enter progress"></textarea>
  <button class="btn" onclick="addProgress()">Add Progress</button>
</div>

<div class="card">
  <h3>Your Business Progress</h3>
  <div id="progressList"></div>
</div>

<script>
const firebaseConfig = { 
  apiKey:"AIzaSyAMnu2djtDKXMrTVKnppeCfKXRCy1KkEYk", 
  authDomain:"lita-platform-bffdc.firebaseapp.com", 
  projectId:"lita-platform-bffdc", 
  storageBucket:"lita-platform-bffdc.firebasestorage.app", 
  messagingSenderId:"387943226211", 
  appId:"1:387943226211:web:0127c409e0f880df391156" 
};
const app = firebase.initializeApp(firebaseConfig,"memberApp");
const auth = firebase.auth(app);
const db = firebase.firestore(app);

let memberId, memberData;

auth.onAuthStateChanged(user=>{
  if(user){
    db.collection("members").doc(user.uid).get().then(doc=>{
      if(!doc.exists){ alert("Profile not found"); auth.signOut(); window.location.href="signin.html"; return; }
      memberData = doc.data();
      memberId = doc.id;
      document.getElementById("memberName").textContent = memberData.fullName;
      renderProgress();
    });
  } else { window.location.href="signin.html"; }
});

function renderProgress(){
  const div = document.getElementById("progressList");
  div.innerHTML="";
  (memberData.businessProgress||[]).forEach((p,i)=>{
    const e = document.createElement("div");
    e.className="progress-entry";
    e.innerHTML=`${p.text} <button onclick="deleteProgress(${i})">üóëÔ∏è</button>`;
    div.appendChild(e);
  });
}

function addProgress(){
  const text = document.getElementById("progressText").value.trim();
  if(!text) return alert("Enter progress");
  memberData.businessProgress = memberData.businessProgress||[];
  memberData.businessProgress.push({text, date:new Date()});
  db.collection("members").doc(memberId).update({businessProgress:memberData.businessProgress})
    .then(()=>{ document.getElementById("progressText").value=""; renderProgress(); });
}

function deleteProgress(idx){
  if(confirm("Delete this progress?")){
    memberData.businessProgress.splice(idx,1);
    db.collection("members").doc(memberId).update({businessProgress:memberData.businessProgress})
      .then(()=> renderProgress());
  }
}

function logout(){ auth.signOut().then(()=>window.location.href="signin.html"); }
</script>
</body>
</html>
