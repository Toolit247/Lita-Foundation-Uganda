<script>
  var firebaseConfig = {
    apiKey: "AIzaSyAMnu2djtDKXMrTVKnppeCfKXRCy1KkEYk",
    authDomain: "lita-platform-bffdc.firebaseapp.com",
    projectId: "lita-platform-bffdc",
    storageBucket: "lita-platform-bffdc.appspot.com",
    messagingSenderId: "387943226211",
    appId: "1:387943226211:web:0127c409e0f880df391156"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  firebase.auth().onAuthStateChanged(user => {
    if (!user || user.email !== "toolitambrosehenry@gmail.com") {
      window.location.href = "signin.html";
    } else {
      loadMembers();
    }
  });

  function loadMembers() {
    const tbody = document.querySelector("#membersTable tbody");
    tbody.innerHTML = "";
    db.collection("members").get().then(querySnapshot => {
      querySnapshot.forEach(doc => {
        const data = doc.data();
        const row = `<tr>
          <td>${data.fullName}</td>
          <td>${data.email}</td>
          <td>${data.phone}</td>
          <td>${data.gender}</td>
          <td>${data.location}</td>
          <td>${data.upline}</td>
          <td>${data.businessProgress || 'N/A'}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    });
  }

  document.getElementById("exportCSV").addEventListener("click", () => {
    db.collection("members").get().then(querySnapshot => {
      let csvContent = "data:text/csv;charset=utf-8,Full Name,Email,Phone,Gender,Location,Upline ID,Business Progress\n";
      querySnapshot.forEach(doc => {
        const d = doc.data();
        csvContent += `${d.fullName},${d.email},${d.phone},${d.gender},${d.location},${d.upline},${d.businessProgress || 'N/A'}\n`;
      });
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "LITA_Members.csv");
      document.body.appendChild(link);
      link.click();
    });
  });

  document.getElementById("logout").addEventListener("click", () => {
    firebase.auth().signOut().then(() => window.location.href = "signin.html");
  });
</script>
